<Page x:Class="coach_search.Views.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:coach_search.Views"
      xmlns:vm="clr-namespace:coach_search.ViewModels"
        xmlns:v="clr-namespace:coach_search.Views"

      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--<DataTemplate DataType="{x:Type vm:TutorProfileViewPublicViewModel}">
                <v:TutorProfileViewPublic />
            </DataTemplate>-->
        </ResourceDictionary>

    </Page.Resources>


    <ScrollViewer>
        <StackPanel Margin="40">

            <TextBlock Text="Поиск репетиторов"
                       Style="{StaticResource TitleText}" />

            <!-- Поисковая панель -->
            <StackPanel Orientation="Horizontal" Margin="0,20,0,0">

                <TextBox Width="400"
                         Height="40"
                         Style="{StaticResource InputBox}"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                <Button Content="🔍"
                        Width="50"
                        Height="40"
                        Command="{Binding SearchCommand}"
                        Style="{StaticResource AccentButton}"
                        Margin="10,0"/>
            </StackPanel>

            <!-- Фильтры -->
            <StackPanel Orientation="Horizontal" Margin="0,20,0,0">

                <TextBlock Text="Предмет:" Style="{StaticResource LabelText}" Margin="0,10,20,0"/>

                <ComboBox Width="200"
                          ItemsSource="{Binding Subjects}"
                          SelectedItem="{Binding SelectedSubject}"
                          Style="{StaticResource InputCombo}" />

                <TextBlock Text="Цена от" Margin="30,10,20,0" Style="{StaticResource LabelText}" />

                <TextBox Style="{StaticResource InputBox}"
                         Width="200"
                         Text="{Binding MinPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" >
                </TextBox>

                <TextBlock Text="до" Margin="30,10,20,0" Style="{StaticResource LabelText}" />

                <TextBox Style="{StaticResource InputBox}"
                         Width="200"
                         Text="{Binding MaxPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" >
                </TextBox>

                <Button Content="Очистить"
                        Width="120"
                        Height="40"
                        Command="{Binding ClearCommand}"
                        Style="{StaticResource AccentButton}"
                        Margin="40,0"/>
            </StackPanel>

            <TextBlock Text="Результаты"
                       Margin="0,30,0,10"
                       Style="{StaticResource SubtitleText}" />

            <ItemsControl ItemsSource="{Binding FilteredTutors}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemWidth="500"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>

                        <Border BorderBrush="#E6C4A8" BorderThickness="2"
                                CornerRadius="10" Padding="20"
                                Margin="10" Background="#F9E7D8">

                            <StackPanel Orientation="Horizontal">

                                <!--<Ellipse Width="70" Height="70" Fill="#E6C4A8"/>-->

                                <!-- Внутренний круг с фотографией -->
                                <Ellipse Width="70" Height="70" Margin="0 -40 0 0">
                                    <Ellipse.Fill>
                                        <ImageBrush ImageSource="{Binding PhotoPath}" Stretch="UniformToFill"/>
                                    </Ellipse.Fill>
                                </Ellipse>

                                <StackPanel Margin="20,0">
                                    <TextBlock Text="{Binding FullName}"
                                               FontSize="20"
                                               FontWeight="Bold"/>

                                    <TextBlock Text="{Binding TutorInfo.Subject}"/>

                                    <TextBlock>
                                        <Run Text="Цена: "/>
                                        <Run Text="{Binding TutorInfo.PricePerHour}"/>
                                        <Run Text=" ₽/час"/>
                                    </TextBlock>

                                    <Button Content="Посмотреть профиль"
                                        Width="180"
                                        Margin="0,10"
                                        Style="{StaticResource AccentButton}"
                                        Command="{Binding DataContext.SelectCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                        CommandParameter="{Binding Id}"/>

                                </StackPanel>
                            </StackPanel>
                        </Border>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </StackPanel>
    </ScrollViewer>
</Page>
